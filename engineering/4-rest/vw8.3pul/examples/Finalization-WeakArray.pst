<?xml version="1.0"?><st-source><!-- Name: Finalization-WeakArrayNotice: Copyright 2009-2014 Cincom Systems, Inc.  All rights reserved.Comment: The WeakArray example from the documentation (ADG).DbIdentifier: bear73DbTrace: 427992DbUsername: smichaelDbVersion: 1.3PackageName: Finalization-WeakArrayParcel: #('Finalization-WeakArray')ParcelName: Finalization-WeakArrayPrintStringCache: (1.3,smichael)Version: 1.3Date: 5:06:48 PM May 26, 2017 --><time-stamp>From VisualWorksÂ®, Pre-Release 8.3 (may17.4) of May 26, 2017 on May 26, 2017 at 5:06:48 PM</time-stamp><do-it>(Dialog confirm: 'You are filing-in a Parcel source file!\\While this is possible it will not have\the same effect as loading the parcel.\None of the Parcel''s prerequisites will\be loaded and none of its load actions\will be performed.\\Are you sure you want to file-in?' withCRs) ifFalse: [self error: 'Parcel file-in abandoned.  Choose terminate or close.']</do-it><class><name>Executor</name><environment>Smalltalk</environment><super>Core.Object</super><private>false</private><indexed-type>none</indexed-type><inst-vars>familyMembers familyWills </inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>Finalization-Example</category><attributes><package>Finalization-WeakArray</package></attributes></class><comment><class-id>Executor</class-id><body>The Executor class is a simple example of how finalization can be achieved by using WeakArrays. After entering the code into the system, evaluate the expression "Executor example inspect"Instance VariablesfamilyMembers	&lt;WeakArray&gt; containing the name string of each family member.familyWills	&lt;Array&gt; of blocks that will print the last will and testament of the corresponding person in the familyMembers array on the Transcript.</body></comment><methods><class-id>Executor</class-id> <category>accessing</category><body package="Finalization-WeakArray">familyMembers	^familyMembers</body><body package="Finalization-WeakArray">familyMembers: aWeakArray 	familyMembers removeDependent: self.	familyMembers := aWeakArray.	familyMembers addDependent: self</body><body package="Finalization-WeakArray">familyWills	^familyWills</body><body package="Finalization-WeakArray">familyWills: anArray 	familyWills := anArray</body></methods><methods><class-id>Executor</class-id> <category>finalization</category><body package="Finalization-WeakArray">readLastWillAndTestamentOfTheDeparted	"Read the will of each family member who has died."	familyMembers nilAllCorpsesAndDo: [:deadIndex | 		(familyWills at: deadIndex) value]</body></methods><methods><class-id>Executor</class-id> <category>updating</category><body package="Finalization-WeakArray">update: anAspectSymbol with: aParameter from: aSender 	"Finalize all finalizable entries of aSender."	(aSender == familyMembers and: 		[anAspectSymbol = #ElementExpired])		ifTrue: [self readLastWillAndTestamentOfTheDeparted]		ifFalse: [^self]</body></methods><methods><class-id>Executor class</class-id> <category>example</category><body package="Finalization-WeakArray">example	"Executor example inspect"	| family wills familyLawyer |	family := WeakArray		with: 'cain' copy		with: 'abel' copy		with: 'eve' copy		with: 'adam' copy.	wills := Array		with: [Transcript show: 			'Cain has died. Bequeaths his assets to the church.'; cr]		with: [Transcript show: 			'Abel has died. Killed by Cain for his assets.'; cr]		with: [Transcript show: 			'Eve has died. Bequeaths her assets to Abel.'; cr] 		with: [Transcript show: 			'Adam has died. Bequeaths his assets to Eve.'; cr]. 	familyLawyer := Executor new. 	familyLawyer familyWills: wills. 	familyLawyer familyMembers: family. 	^familyLawyer</body></methods><do-it>"Imported Classes:"</do-it><do-it>self error: 'Attempting to file-in parcel imports.  Choose terminate or close'</do-it><class><name>Object</name><environment>Core</environment><super></super><private>false</private><indexed-type>none</indexed-type><inst-vars></inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>Kernel-Objects</category><attributes><package>Kernel-Objects</package></attributes></class></st-source>